name: Crate Quality Matrix

on:
    workflow_dispatch:
    schedule:
        - cron: "0 3 * * 1"

jobs:
    generate-matrix:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4
            - name: Run inventory script
              run: |
                  node CTAS7_Inventory_Tools/generate_crate_specs.js
            - name: Upload generated crate-specs
              uses: actions/upload-artifact@v4
              with:
                  name: crate-specs
                  path: crate-specs/*.yml

    per-crate-qc:
        needs: generate-matrix
        runs-on: ubuntu-latest
        strategy:
            matrix:
                crate: ${{ fromJson(needs.generate-matrix.outputs.crate_list || '[]') }}
        steps:
            - uses: actions/checkout@v4
            - name: Set up Rust
              uses: actions-rs/toolchain@v1
              with:
                  toolchain: stable
            - name: Run cargo audit
              run: |
                  echo "Running cargo audit for ${{ matrix.crate }}"
                  # placeholder: run audit against crate path
